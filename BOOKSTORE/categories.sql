SELECT cus.cid, cus.name , CC.cat ,CC.COST FROM (SELECT BB.cid, BB.cat , SUM(BB.price ) AS COST FROM(select * FROM (select off.club, off.title, off.year, off.price, boo.cat FROM yrb_book boo, yrb_offer off WHERE boo.title = off.title AND boo.year = off.year) AA, yrb_purchase pur WHERE pur.club = AA.club AND pur.year = AA.year AND pur.title = AA.title )BB GROUP BY BB.cid, BB.cat) CC, yrb_customer cus WHERE cus.cid = CC.cid;
